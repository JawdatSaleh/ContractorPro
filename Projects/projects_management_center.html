<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>مركز إدارة المشاريع | ContractorPro</title>
    <link rel="stylesheet" href="../css/main.css" />
    <link rel="stylesheet" href="css/projects.css" />
    <link rel="stylesheet" href="css/responsive.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
  </head>
  <body class="bg-background font-arabic projects-module" data-page="projects-management">
    <aside class="fixed right-0 top-0 h-full w-64 bg-surface shadow-modal z-40 border-l border-border">
      <div class="p-6 border-b border-border">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 bg-primary rounded-lg flex items-center justify-center">
            <i class="fas fa-hard-hat text-white text-lg"></i>
          </div>
          <div>
            <h1 class="text-xl font-bold text-text-primary">ContractorPro</h1>
            <p class="text-xs text-text-secondary">نظام إدارة المقاولات المتكامل</p>
          </div>
        </div>
      </div>
      <nav class="p-4 space-y-1 text-sm">
        <a href="../pages/main_dashboard.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-text-secondary hover:bg-secondary-100 transition">
          <i class="fas fa-gauge w-5"></i>
          <span class="font-medium">اللوحة الرئيسية</span>
        </a>
        <a href="projects_management_center.html" class="flex items-center gap-3 px-4 py-3 rounded-lg bg-primary-50 text-primary border-r-4 border-primary">
          <i class="fas fa-layer-group w-5"></i>
          <span class="font-semibold">إدارة المشاريع</span>
          <span class="text-xs text-primary-600 mr-auto">الوحدة الحالية</span>
        </a>
        <a href="../pages/financial_management_center.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-text-secondary hover:bg-secondary-100 transition">
          <i class="fas fa-coins w-5"></i>
          <span class="font-medium">المالية</span>
        </a>
        <a href="../pages/human_resources_center.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-text-secondary hover:bg-secondary-100 transition">
          <i class="fas fa-user-tie w-5"></i>
          <span class="font-medium">الموارد البشرية</span>
        </a>
        <a href="../pages/financial_operations_dashboard.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-text-secondary hover:bg-secondary-100 transition">
          <i class="fas fa-chart-line w-5"></i>
          <span class="font-medium">العمليات</span>
        </a>
      </nav>
    </aside>

    <div class="mr-64 min-h-screen">
      <header class="projects-sticky-actions px-8 py-6 shadow-card border-b border-border">
        <div class="flex flex-col gap-6">
          <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
            <div>
              <h1 class="text-3xl font-bold text-text-primary">مركز إدارة المشاريع</h1>
              <p class="text-text-secondary text-sm">
                قُم بإدارة محفظتك من المشاريع، راقب الأداء المالي والتشغيلي، ونسّق فرق العمل في مكان واحد.
              </p>
            </div>
            <div class="flex flex-wrap items-center gap-3">
              <button id="newProjectBtn" class="bg-primary text-white px-4 py-2 rounded-lg shadow-card hover:bg-primary-600 transition flex items-center gap-2">
                <i class="fas fa-plus"></i>
                <span>مشروع جديد</span>
              </button>
              <button id="exportProjectsBtn" class="bg-success-100 text-success px-4 py-2 rounded-lg border border-success-200 hover:bg-success-200 transition flex items-center gap-2">
                <i class="fas fa-download"></i>
                <span>تصدير البيانات</span>
              </button>
              <div class="flex items-center gap-2 bg-surface border border-border px-3 py-2 rounded-lg">
                <i class="fas fa-database text-primary"></i>
                <span class="text-xs text-text-secondary">آخر مزامنة: <span id="lastSyncLabel" class="font-semibold text-text-primary">-</span></span>
              </div>
            </div>
          </div>
          <div class="projects-summary-grid" id="summaryCards"></div>
        </div>
      </header>

      <main class="p-8 space-y-8">
        <section id="projectsPipelineSection" class="bg-surface border border-border rounded-2xl shadow-card p-6 space-y-6">
          <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6">
            <div class="flex items-center gap-3 bg-secondary-50 border border-secondary-100 rounded-xl px-4 py-3">
              <i class="fas fa-filter text-secondary"></i>
              <div>
                <h2 class="text-lg font-semibold text-text-primary">منظومة التصفية الذكية</h2>
                <p class="text-xs text-text-secondary">تحكم بجميع المؤشرات عبر البحث، التصفية، وترتيب المشاريع.</p>
              </div>
            </div>
            <div class="flex items-center gap-3">
              <button id="toggleViewBtn" class="px-4 py-2 rounded-lg border border-border text-sm font-medium hover:border-primary transition flex items-center gap-2">
                <i class="fas fa-table"></i>
                <span id="toggleViewLabel">عرض لوحة البيانات</span>
              </button>
              <button id="resetFiltersBtn" class="px-4 py-2 rounded-lg border border-border text-sm text-text-secondary hover:text-primary transition flex items-center gap-2">
                <i class="fas fa-undo"></i>
                <span>إعادة التصفية</span>
              </button>
            </div>
          </div>
          <div class="projects-filters" id="filtersForm">
            <div class="filter-group flex flex-col gap-1">
              <label class="text-xs font-semibold text-text-secondary">الحالة</label>
              <select id="statusFilter" class="bg-surface border border-border rounded-lg px-3 py-2 focus:border-primary focus:ring-2 focus:ring-primary-200">
                <option value="all">جميع الحالات</option>
                <option value="active">نشط</option>
                <option value="planning">قيد التخطيط</option>
                <option value="on-hold">معلق</option>
                <option value="completed">منجز</option>
              </select>
            </div>
            <div class="filter-group flex flex-col gap-1">
              <label class="text-xs font-semibold text-text-secondary">مستوى المخاطر</label>
              <select id="riskFilter" class="bg-surface border border-border rounded-lg px-3 py-2 focus:border-primary focus:ring-2 focus:ring-primary-200">
                <option value="all">جميع المستويات</option>
                <option value="low">منخفض</option>
                <option value="medium">متوسط</option>
                <option value="high">مرتفع</option>
              </select>
            </div>
            <div class="filter-group flex flex-col gap-1">
              <label class="text-xs font-semibold text-text-secondary">مدير المشروع</label>
              <select id="managerFilter" class="bg-surface border border-border rounded-lg px-3 py-2 focus:border-primary focus:ring-2 focus:ring-primary-200">
                <option value="all">جميع المدراء</option>
              </select>
            </div>
            <div class="filter-group flex-1 flex flex-col gap-1 min-w-[220px]">
              <label class="text-xs font-semibold text-text-secondary">بحث في المشاريع</label>
              <div class="relative">
                <input id="projectSearch" type="search" placeholder="ابحث بالاسم، العميل، المدينة أو معرف المشروع" class="w-full bg-surface border border-border rounded-lg px-10 py-2 focus:border-primary focus:ring-2 focus:ring-primary-200" />
                <i class="fas fa-search absolute top-2.5 right-3 text-text-secondary"></i>
              </div>
            </div>
            <div class="filter-group flex flex-col gap-1">
              <label class="text-xs font-semibold text-text-secondary">المدة المتبقية</label>
              <select id="timelineFilter" class="bg-surface border border-border rounded-lg px-3 py-2 focus:border-primary focus:ring-2 focus:ring-primary-200">
                <option value="all">جميع الفترات</option>
                <option value="lt90">أقل من 90 يوم</option>
                <option value="lt180">أقل من 180 يوم</option>
                <option value="gt180">أكثر من 180 يوم</option>
              </select>
            </div>
          </div>
        </section>

        <section id="projectsDataSection" class="projects-data-grid">
          <div class="bg-surface border border-border rounded-2xl shadow-card overflow-hidden">
            <div class="px-6 py-4 border-b border-border flex items-center justify-between">
              <div>
                <h2 class="text-xl font-bold text-text-primary">قائمة المشاريع</h2>
                <p class="text-xs text-text-secondary">تم العثور على <span id="projectsCount" class="font-semibold text-primary">0</span> مشروع وفق التصفية الحالية.</p>
              </div>
              <div class="flex items-center gap-3 text-xs text-text-secondary">
                <span class="flex items-center gap-1"><i class="fas fa-circle text-success text-[8px]"></i> في الموعد</span>
                <span class="flex items-center gap-1"><i class="fas fa-circle text-warning text-[8px]"></i> يحتاج متابعة</span>
                <span class="flex items-center gap-1"><i class="fas fa-circle text-danger text-[8px]"></i> متعثر</span>
              </div>
            </div>
            <div class="overflow-x-auto">
              <table class="projects-table" id="projectsTable">
                <thead>
                  <tr>
                    <th class="text-right pr-6">المشروع</th>
                    <th>العميل</th>
                    <th>قيمة العقد</th>
                    <th>نسبة الإنجاز</th>
                    <th>مدير المشروع</th>
                    <th>المخاطر</th>
                    <th>الحالة</th>
                  </tr>
                </thead>
                <tbody id="projectsTableBody"></tbody>
              </table>
            </div>
            <div id="projectsEmptyState" class="projects-empty-state hidden">
              <i class="fas fa-folder-open"></i>
              <h3 class="text-lg font-semibold text-text-primary">لا توجد مشاريع مطابقة</h3>
              <p class="text-sm text-text-secondary">قم بتعديل معايير التصفية أو أنشئ مشروعاً جديداً الآن.</p>
            </div>
          </div>

          <aside id="projectDetailPanel" class="projects-detail-panel bg-surface border border-border shadow-card rounded-2xl p-6 space-y-6 hidden">
            <div class="flex items-start gap-4">
              <div class="bg-primary-50 text-primary rounded-xl w-12 h-12 flex items-center justify-center text-xl">
                <i class="fas fa-diagram-project"></i>
              </div>
              <div class="flex-1">
                <div class="flex items-center gap-3 flex-wrap">
                  <h3 id="detailName" class="text-2xl font-bold text-text-primary">-</h3>
                  <span id="detailStatus" class="projects-tag neutral">-</span>
                  <span id="detailRisk" class="projects-tag">-</span>
                </div>
                <p id="detailClient" class="text-sm text-text-secondary">-</p>
                <p id="detailLocation" class="text-xs text-text-secondary">-</p>
              </div>
            </div>

            <div class="grid grid-cols-2 gap-4 text-sm" id="detailMetrics"></div>

            <div>
              <h4 class="text-sm font-semibold text-text-secondary mb-3">المهام الرئيسية</h4>
              <ul id="detailDeliverables" class="space-y-3 text-sm"></ul>
            </div>

            <div>
              <h4 class="text-sm font-semibold text-text-secondary mb-3">الخط الزمني</h4>
              <ul id="detailTimeline" class="projects-timeline text-sm"></ul>
            </div>

            <div>
              <h4 class="text-sm font-semibold text-text-secondary mb-3">الفرق المسؤولة</h4>
              <div id="detailTeams" class="space-y-3 text-sm"></div>
            </div>

            <div>
              <h4 class="text-sm font-semibold text-text-secondary mb-3">الوثائق الأخيرة</h4>
              <ul id="detailDocuments" class="space-y-2 text-xs text-text-secondary"></ul>
            </div>

            <div class="projects-detail-actions">
              <button id="openInWizardBtn" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-600 transition flex items-center justify-center gap-2">
                <i class="fas fa-pen-to-square"></i>
                <span>تحرير المشروع</span>
              </button>
              <button id="downloadProjectBtn" class="bg-secondary-100 text-text-primary px-4 py-2 rounded-lg hover:bg-secondary-200 transition flex items-center justify-center gap-2">
                <i class="fas fa-file-arrow-down"></i>
                <span>تحميل بطاقة المشروع</span>
              </button>
              <button id="openOverviewBtn" class="bg-primary-50 text-primary px-4 py-2 rounded-lg hover:bg-primary-100 transition flex items-center justify-center gap-2">
                <i class="fas fa-circle-info"></i>
                <span>عرض نظرة عامة</span>
              </button>
            </div>
          </aside>
        </section>

        <section class="bg-surface border border-border rounded-2xl shadow-card p-6 space-y-6">
          <div class="flex items-center justify-between">
            <div>
              <h2 class="text-xl font-bold text-text-primary">لوحة التحكم التنفيذية</h2>
              <p class="text-xs text-text-secondary">نظرة فورية على مراحل التنفيذ، المخاطر الحرجة، والفرص التجارية.</p>
            </div>
            <div class="flex items-center gap-3 text-xs text-text-secondary">
              <span class="metric-pill neutral" id="activeCountBadge">0 مشاريع نشطة</span>
              <span class="metric-pill positive" id="pipelineValueBadge">قيمة العقود 0 ر.س</span>
            </div>
          </div>
          <div class="projects-kanban" id="pipelineBoard"></div>
        </section>
      </main>
    </div>

    <script type="module" src="js/main.js"></script>
  </body>
</html>
