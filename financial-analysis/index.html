<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Project Financial Analysis</title>
    <link rel="stylesheet" href="assets/styles.css" />
    <link rel="stylesheet" href="assets/rtl.css" id="rtlStylesheet" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/tabulator-tables@5.6.2/dist/css/tabulator.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/tabulator-tables@5.6.2/dist/css/tabulator_midnight.min.css"
      media="(prefers-color-scheme: dark)"
    />
  </head>
  <body>
    <header class="app-header">
      <div class="logo">๐๏ธ ContractorPro</div>
      <nav class="language-toggle" aria-label="Language switcher">
        <button data-lang="ar" class="lang-btn is-active">ุงูุนุฑุจูุฉ</button>
        <button data-lang="en" class="lang-btn">English</button>
      </nav>
    </header>

    <main id="app" class="app-shell">
      <aside class="side-nav">
        <ul>
          <li><a href="#info">๐งพ <span data-i18n="nav.info">ุงููุนูููุงุช</span></a></li>
          <li><a href="#phases">๐งฑ <span data-i18n="nav.phases">ูุฑุงุญู ุงููุดุฑูุน</span></a></li>
          <li><a href="#financial-analysis" class="is-active">๐น <span data-i18n="nav.financial">ุงูุชุญููู ุงููุงูู</span></a></li>
          <li><a href="#expenses">๐ฐ <span data-i18n="nav.expenses">ุงููุตุงุฑูู ูุงูุนููุฏ</span></a></li>
          <li><a href="#payments">๐ณ <span data-i18n="nav.payments">ุฏูุนุงุช ุงููุดุฑูุน</span></a></li>
          <li><a href="#reports">๐ <span data-i18n="nav.reports">ุงูุชูุงุฑูุฑ ุงูููููุฉ</span></a></li>
        </ul>
      </aside>

      <section class="tab-panel" id="financial-analysis">
        <h1 class="panel-title" data-i18n="titles.financialAnalysis">ุงูุชุญููู ุงููุงูู</h1>

        <section class="filters" aria-label="Filters toolbar">
          <div class="filter-group">
            <label for="projectSelect" data-i18n="filters.project">ุงููุดุฑูุน</label>
            <select id="projectSelect"></select>
          </div>
          <div class="filter-group">
            <label for="phaseSelect" data-i18n="filters.phase">ุงููุฑุญูุฉ</label>
            <select id="phaseSelect" multiple></select>
          </div>
          <div class="filter-group">
            <label for="statusSelect" data-i18n="filters.invoiceStatus">ุญุงูุฉ ุงููุงุชูุฑุฉ</label>
            <select id="statusSelect"></select>
          </div>
          <div class="filter-group">
            <label for="currencySelect" data-i18n="filters.currency">ุงูุนููุฉ</label>
            <select id="currencySelect"></select>
          </div>
          <div class="filter-group">
            <label for="dateFrom" data-i18n="filters.dateFrom">ูู ุชุงุฑูุฎ</label>
            <input type="date" id="dateFrom" />
          </div>
          <div class="filter-group">
            <label for="dateTo" data-i18n="filters.dateTo">ุฅูู ุชุงุฑูุฎ</label>
            <input type="date" id="dateTo" />
          </div>
          <div class="filter-actions">
            <button id="applyFilters" class="btn primary" data-i18n="actions.apply">ุชุทุจูู</button>
            <button id="resetFilters" class="btn ghost" data-i18n="actions.reset">ุฅุนุงุฏุฉ ุชุนููู</button>
          </div>
        </section>

        <section class="kpi-grid" aria-label="Key performance indicators" id="kpiContainer">
          <!-- KPI cards rendered by JS -->
        </section>

        <section class="charts-grid">
          <article class="chart-card">
            <header>
              <h2 data-i18n="charts.cashflow">ุงูุชุฏูู ุงูููุฏู</h2>
              <button class="btn ghost export-chart" data-chart="cashflow" data-i18n="actions.export">ุชุตุฏูุฑ</button>
            </header>
            <canvas id="cashflowChart" aria-describedby="cashflowDesc"></canvas>
            <p id="cashflowDesc" class="sr-only" data-i18n="charts.cashflowDesc">ุฑุณู ูุธูุฑ ุงูุชุฏูู ุงูููุฏู ุงูุฏุงุฎู ูุงูุฎุงุฑุฌ ูุตุงูู ุงูุชุฏูู ุดูุฑููุง.</p>
          </article>

          <article class="chart-card">
            <header>
              <h2 data-i18n="charts.budgetActual">ุงูููุฒุงููุฉ ููุงุจู ุงููุนูู</h2>
              <button class="btn ghost export-chart" data-chart="budgetActual" data-i18n="actions.export">ุชุตุฏูุฑ</button>
            </header>
            <canvas id="budgetActualChart"></canvas>
          </article>

          <article class="chart-card">
            <header>
              <h2 data-i18n="charts.cpiSpi">ุฃุฏุงุก ุงูุฌุฏูู ูุงูุชูููุฉ</h2>
              <button class="btn ghost export-chart" data-chart="cpiSpi" data-i18n="actions.export">ุชุตุฏูุฑ</button>
            </header>
            <canvas id="cpiSpiChart"></canvas>
          </article>

          <article class="chart-card">
            <header>
              <h2 data-i18n="charts.waterfall">ุชุฃุซูุฑ ุฃูุงูุฑ ุงูุชุบููุฑ</h2>
              <button class="btn ghost export-chart" data-chart="waterfall" data-i18n="actions.export">ุชุตุฏูุฑ</button>
            </header>
            <canvas id="waterfallChart"></canvas>
          </article>
        </section>

        <section class="tables-grid">
          <article class="table-card">
            <header>
              <h2 data-i18n="tables.variance">ุงูุงูุญุฑุงู ุญุณุจ ุงููุฑุญูุฉ</h2>
              <div class="table-actions">
                <button class="btn ghost export-table" data-table="variance" data-format="csv">CSV</button>
                <button class="btn ghost export-table" data-table="variance" data-format="xlsx">Excel</button>
                <button class="btn ghost export-table" data-table="variance" data-format="pdf">PDF</button>
              </div>
            </header>
            <div id="varianceTable" class="data-table"></div>
          </article>

          <article class="table-card">
            <header>
              <h2 data-i18n="tables.expenses">ุฏูุชุฑ ุงููุตุฑููุงุช</h2>
              <div class="table-actions">
                <button class="btn ghost export-table" data-table="expenses" data-format="csv">CSV</button>
                <button class="btn ghost export-table" data-table="expenses" data-format="xlsx">Excel</button>
                <button class="btn ghost export-table" data-table="expenses" data-format="pdf">PDF</button>
              </div>
            </header>
            <div id="expensesTable" class="data-table"></div>
          </article>

          <article class="table-card">
            <header>
              <h2 data-i18n="tables.payments">ููุงุชูุฑ ุงูุนููุงุก / ุฏูุนุงุช ุงูููุงูููู</h2>
              <div class="table-actions">
                <button class="btn ghost export-table" data-table="payments" data-format="csv">CSV</button>
                <button class="btn ghost export-table" data-table="payments" data-format="xlsx">Excel</button>
                <button class="btn ghost export-table" data-table="payments" data-format="pdf">PDF</button>
              </div>
            </header>
            <div id="paymentsTable" class="data-table"></div>
          </article>
        </section>

        <section class="whatif-panel" id="whatIfPanel">
          <header>
            <h2 data-i18n="whatif.title">ูุญุงูุงุฉ ุงูุณููุงุฑูููุงุช</h2>
            <p data-i18n="whatif.subtitle">ูู ุจุถุจุท ุงูุชุบููุฑุงุช ูุดุงูุฏ ุชุฃุซูุฑูุง ุนูู ูุคุดุฑุงุช ุงููุดุฑูุน.</p>
          </header>
          <div class="whatif-controls">
            <div class="slider-group">
              <label for="materialsSlider" data-i18n="whatif.materials">ุชูููุฉ ุงูููุงุฏ</label>
              <input type="range" id="materialsSlider" min="-10" max="10" step="5" value="0" />
              <span class="slider-value" data-for="materialsSlider">0%</span>
            </div>
            <div class="slider-group">
              <label for="laborSlider" data-i18n="whatif.labor">ุชูููุฉ ุงูุฃุฌูุฑ</label>
              <input type="range" id="laborSlider" min="-10" max="10" step="5" value="0" />
              <span class="slider-value" data-for="laborSlider">0%</span>
            </div>
            <div class="slider-group">
              <label for="scopeSlider" data-i18n="whatif.scope">ุชุบูุฑ ูุทุงู ุงูุนูู</label>
              <input type="range" id="scopeSlider" min="-10" max="10" step="5" value="0" />
              <span class="slider-value" data-for="scopeSlider">0%</span>
            </div>
            <div class="slider-group">
              <label for="delaySlider" data-i18n="whatif.delay">ุชุฃุฎูุฑ ุงูุชูููุฐ (ุฃูุงู)</label>
              <input type="range" id="delaySlider" min="0" max="30" step="5" value="0" />
              <span class="slider-value" data-for="delaySlider">0</span>
            </div>
          </div>
          <div class="whatif-results" id="whatIfResults"></div>
        </section>
      </section>
    </main>

    <div id="drilldownModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
      <div class="modal-content">
        <header class="modal-header">
          <h2 data-i18n="modal.title">ุชูุงุตูู ุงููููุฏ</h2>
          <button class="modal-close" aria-label="Close">ร</button>
        </header>
        <div class="modal-body">
          <div id="drilldownContent"></div>
        </div>
      </div>
    </div>

    <template id="kpiCardTemplate">
      <article class="kpi-card" tabindex="0">
        <header>
          <h3 class="kpi-label"></h3>
          <button class="info" aria-label="Info">?</button>
        </header>
        <p class="kpi-value">--</p>
        <p class="kpi-delta"></p>
      </article>
    </template>

    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/isoWeek.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tabulator-tables@5.6.2/dist/js/tabulator.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

    <script type="module" src="js/app.js"></script>
  </body>
</html>
