<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>مركز إدارة الموظفين - ContractorPro</title>
    <link rel="stylesheet" href="../css/main.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />

    <script type="module" src="https://static.rocket.new/rocket-web.js?_cfg=https%3A%2F%2Fcontractor7112back.builtwithrocket.new&_be=https%3A%2F%2Fapplication.rocket.new&_v=0.1.8"></script>
    <script type="module" src="https://static.rocket.new/rocket-shot.js?v=0.0.1"></script>
</head>
<body class="bg-background font-arabic">
    <!-- Navigation Sidebar -->
    <div class="fixed right-0 top-0 h-full w-64 bg-surface shadow-modal z-50 transform transition-transform duration-300" id="sidebar">
        <div class="p-6 border-b border-border">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-primary rounded-lg flex items-center justify-center">
                    <i class="fas fa-hard-hat text-white text-lg"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold text-text-primary">ContractorPro</h1>
                    <p class="text-sm text-text-secondary">نظام إدارة المقاولات</p>
                </div>
            </div>
        </div>

        <nav class="p-4 space-y-2">
            <!-- Dashboard -->
            <a href="main_dashboard.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-text-secondary hover:bg-secondary-100 transition-fast">
                <i class="fas fa-tachometer-alt w-5"></i>
                <span class="font-medium">لوحة التحكم</span>
            </a>

            <!-- Projects Section -->
            <a href="projects_management_center.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-text-secondary hover:bg-secondary-100 transition-fast">
                <i class="fas fa-building w-5"></i>
                <span>المشاريع</span>
            </a>

            <a href="project_phases.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-text-secondary hover:bg-secondary-100 transition-fast">
                <i class="fas fa-tasks w-5"></i>
                <span>مراحل المشاريع</span>
            </a>

            <a href="project_information.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-text-secondary hover:bg-secondary-100 transition-fast">
                <i class="fas fa-info-circle w-5"></i>
                <span>معلومات المشاريع</span>
            </a>

            <a href="project_expenses.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-text-secondary hover:bg-secondary-100 transition-fast">
                <i class="fas fa-receipt w-5"></i>
                <span>مصاريف المشاريع</span>
            </a>

            <!-- Finance Section -->
            <a href="financial_management_center.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-text-secondary hover:bg-secondary-100 transition-fast">
                <i class="fas fa-chart-line w-5"></i>
                <span>المالية</span>
            </a>

            <a href="financial_center.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-text-secondary hover:bg-secondary-100 transition-fast">
                <i class="fas fa-coins w-5"></i>
                <span>المركز المالي</span>
            </a>

            <a href="tax_invoice_generator.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-text-secondary hover:bg-secondary-100 transition-fast">
                <i class="fas fa-file-invoice w-5"></i>
                <span>مولد الفواتير الضريبية</span>
            </a>

            <a href="payment_tracking.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-text-secondary hover:bg-secondary-100 transition-fast">
                <i class="fas fa-credit-card w-5"></i>
                <span>تتبع المدفوعات</span>
            </a>

            <!-- Employees Section -->
            <a href="employees_management_center.html" class="flex items-center gap-3 px-4 py-3 rounded-lg bg-primary-50 text-primary border-r-4 border-primary">
                <i class="fas fa-users w-5"></i>
                <span class="font-medium">الموظفين</span>
            </a>

            <a href="team_management.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-text-secondary hover:bg-secondary-100 transition-fast">
                <i class="fas fa-users-cog w-5"></i>
                <span>إدارة الفريق</span>
            </a>

            <!-- Contracts -->
            <a href="subcontractor_contracts.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-text-secondary hover:bg-secondary-100 transition-fast">
                <i class="fas fa-handshake w-5"></i>
                <span>عقود المقاولين الفرعيين</span>
            </a>

            <!-- Settings -->
            <a href="system_settings.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-text-secondary hover:bg-secondary-100 transition-fast">
                <i class="fas fa-cog w-5"></i>
                <span>إعدادات النظام</span>
            </a>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="mr-64 min-h-screen">
        <!-- Top Header -->
        <header class="bg-surface shadow-card px-6 py-4 border-b border-border">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
                <div>
                    <h1 class="text-2xl font-bold text-text-primary">منصة إدارة الموظفين المتكاملة</h1>
                    <p class="text-text-secondary">قسم احترافي يربط الموارد البشرية بالمالية والعقود والسلف مع صلاحيات دقيقة لكل مستخدم.</p>
                </div>

                <div class="flex flex-wrap items-center gap-3">
                    <button data-scroll-to="architecture" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-600 transition-fast flex items-center gap-2">
                        <i class="fas fa-diagram-project"></i>
                        <span>المخطط المعماري</span>
                    </button>
                    <button data-scroll-to="rbac" class="bg-secondary-200 text-text-primary px-4 py-2 rounded-lg hover:bg-secondary-300 transition-fast flex items-center gap-2">
                        <i class="fas fa-user-shield"></i>
                        <span>الأدوار والصلاحيات</span>
                    </button>
                    <button data-scroll-to="apis" class="bg-success text-white px-4 py-2 rounded-lg hover:bg-success-600 transition-fast flex items-center gap-2">
                        <i class="fas fa-plug"></i>
                        <span>تكاملات API</span>
                    </button>
                </div>
            </div>
        </header>

        <main class="p-6 space-y-8">
            <!-- Hero Overview -->
            <section class="bg-surface border border-border rounded-2xl shadow-card p-8">
                <div class="flex flex-col lg:flex-row gap-8">
                    <div class="flex-1 space-y-6">
                        <div class="inline-flex items-center gap-2 bg-primary-50 text-primary px-3 py-1 rounded-full text-sm font-medium">
                            <i class="fas fa-star-of-life"></i>
                            <span>نظام إدارة الموظفين – مواصفة شاملة متكاملة</span>
                        </div>
                        <h2 class="text-3xl font-bold text-text-primary">هدف المنصة</h2>
                        <p class="text-text-secondary leading-relaxed">
                            بناء قسم "إدارة الموظفين" احترافي يشبه أنظمة إدارة المشاريع والمحاسبة العالمية، مع ربط كامل بالمالية والعقود والسلف، وإدارة أدوار وصلاحيات دقيقة (RBAC) بحيث يرى كل مستخدم ما يخصه فقط.
                        </p>
                        <ul class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-text-secondary">
                            <li class="flex items-start gap-2">
                                <i class="fas fa-check text-success mt-1"></i>
                                <span>تكامل مباشر بين الموارد البشرية، المالية، العقود، والسلف.</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <i class="fas fa-check text-success mt-1"></i>
                                <span>واجهات وتجربة مستخدم متسقة مع هوية ContractorPro.</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <i class="fas fa-check text-success mt-1"></i>
                                <span>سياسات صلاحيات متعددة المستويات مع إمكانية التوسع إلى ABAC.</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <i class="fas fa-check text-success mt-1"></i>
                                <span>جاهزية للتدقيق، النسخ الاحتياطي، وتوثيق كل حركة حساسة.</span>
                            </li>
                        </ul>
                    </div>
                    <div class="flex-1 grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div class="border border-border rounded-xl p-5 bg-secondary-50">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-bold text-text-primary">3 خدمات محورية</h3>
                                <i class="fas fa-network-wired text-primary text-xl"></i>
                            </div>
                            <p class="text-text-secondary mt-3 text-sm leading-relaxed">HR، Finance، IAM تعمل كوحدة واحدة مع قواعد بيانات مترابطة ومخازن ملفات متوافقة مع S3.</p>
                        </div>
                        <div class="border border-border rounded-xl p-5 bg-success-50">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-bold text-text-primary">تكاليف دقيقة</h3>
                                <i class="fas fa-coins text-success text-xl"></i>
                            </div>
                            <p class="text-text-secondary mt-3 text-sm leading-relaxed">مراكز التكلفة، حساب تكلفة الساعة لكل موظف، وترحيل قيود الرواتب تلقائيًا للمالية.</p>
                        </div>
                        <div class="border border-border rounded-xl p-5 bg-warning-50">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-bold text-text-primary">مراقبة شاملة</h3>
                                <i class="fas fa-shield-alt text-warning text-xl"></i>
                            </div>
                            <p class="text-text-secondary mt-3 text-sm leading-relaxed">Audit log، soft delete، versioning أساسي، وإخفاء الحقول الحساسة حسب الدور.</p>
                        </div>
                        <div class="border border-border rounded-xl p-5 bg-accent-50">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-bold text-text-primary">جاهزية للتوسع</h3>
                                <i class="fas fa-rocket text-accent text-xl"></i>
                            </div>
                            <p class="text-text-secondary mt-3 text-sm leading-relaxed">بنية قابلة للتوسع بخدمات مستقلة، Job Queue لحساب الرواتب، وواجهات برمجة موحدة.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Architecture Overview -->
            <section id="architecture" class="bg-surface border border-border rounded-2xl shadow-card p-8 space-y-6">
                <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3">
                    <h2 class="text-2xl font-bold text-text-primary">١) نظرة معمارية متكاملة</h2>
                    <span class="text-sm text-text-secondary">Architecture Overview</span>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="border border-border rounded-xl p-6 bg-secondary-50">
                        <h3 class="text-lg font-bold text-text-primary flex items-center gap-2"><i class="fas fa-display text-primary"></i> الواجهة</h3>
                        <p class="text-text-secondary mt-3">React + TypeScript + TailwindCSS (أو Vue) مع تصميم متجاوب يدعم RTL بالكامل.</p>
                        <ul class="mt-4 space-y-2 text-sm text-text-secondary">
                            <li>مكونات تصميم موحدة وDesign System خاص بـ ContractorPro.</li>
                            <li>إدارة حالة عبر Zustand/Redux لتكامل HR ↔ Finance.</li>
                            <li>لوحة تحكم، نماذج ذكية، ورسوم بيانية لحظية.</li>
                        </ul>
                    </div>
                    <div class="border border-border rounded-xl p-6 bg-secondary-50">
                        <h3 class="text-lg font-bold text-text-primary flex items-center gap-2"><i class="fas fa-server text-primary"></i> الخلفية</h3>
                        <p class="text-text-secondary mt-3">Node.js (Express/Fastify) + TypeScript مع طبقات Services وRepositories واضحة.</p>
                        <ul class="mt-4 space-y-2 text-sm text-text-secondary">
                            <li>مصادقة JWT، سياسات RBAC/ABAC، وMiddlewares لإخفاء الحقول.</li>
                            <li>Job Queue لحساب الرواتب وترحيل القيود المالية.</li>
                            <li>تجزئة الخدمات إلى HR، Finance، IAM لخفة وسهولة التوسع.</li>
                        </ul>
                    </div>
                    <div class="border border-border rounded-xl p-6 bg-secondary-50">
                        <h3 class="text-lg font-bold text-text-primary flex items-center gap-2"><i class="fas fa-database text-primary"></i> قاعدة البيانات</h3>
                        <p class="text-text-secondary mt-3">PostgreSQL مع Prisma ORM، فهارس مخصصة، وViews للعرض حسب الدور.</p>
                        <ul class="mt-4 space-y-2 text-sm text-text-secondary">
                            <li>Soft delete + Audit tables لكل كيان حساس.</li>
                            <li>دعم JSONB للبدلات، المرفقات، وإعدادات السياسات.</li>
                            <li>Replication محتمل للتقارير الثقيلة وقراءة مهيأة.</li>
                        </ul>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="border border-border rounded-xl p-6">
                        <h4 class="text-lg font-bold text-text-primary mb-3">الهوية والصلاحيات</h4>
                        <ul class="space-y-2 text-sm text-text-secondary">
                            <li>JWT + Refresh Tokens وتدوير مفاتيح دوري.</li>
                            <li>RBAC مرن مع دعم ABAC لاحقًا حسب المشروع أو مركز التكلفة.</li>
                            <li>سياسات تنزيل المرفقات تعتمد على صلاحية المستخدم.</li>
                        </ul>
                    </div>
                    <div class="border border-border rounded-xl p-6">
                        <h4 class="text-lg font-bold text-text-primary mb-3">الملفات والمرفقات</h4>
                        <ul class="space-y-2 text-sm text-text-secondary">
                            <li>S3-compatible storage أو Cloudinary بإدارة صلاحيات دقيقة.</li>
                            <li>تشفير الروابط الموقّتة (Signed URLs) للعقود والوثائق.</li>
                            <li>تحكم بالنسخ والتعديلات عبر Versioning أساسي.</li>
                        </ul>
                    </div>
                    <div class="border border-border rounded-xl p-6">
                        <h4 class="text-lg font-bold text-text-primary mb-3">الخدمات الفرعية</h4>
                        <ul class="space-y-2 text-sm text-text-secondary">
                            <li><strong>HR:</strong> الموظفون، العقود، الرواتب، الحضور، الإجازات، الأداء.</li>
                            <li><strong>Finance:</strong> الأستاذ العام، القيود، المصاريف/الإيرادات، السلف، المستحقات.</li>
                            <li><strong>IAM:</strong> المستخدمون، الأدوار، الصلاحيات، سياسات الوصول.</li>
                        </ul>
                    </div>
                </div>

                <div class="border border-primary rounded-2xl bg-primary-50 p-6">
                    <h4 class="text-lg font-bold text-primary mb-4">التكاملات المحورية</h4>
                    <ul class="list-disc pr-5 space-y-2 text-text-secondary">
                        <li>تكامل HR ↔ Finance: قيود رواتب، سلف، مستحقات نهاية الخدمة، ومخصصات تلقائية.</li>
                        <li>تكامل HR ↔ Projects: إسناد الموظفين للمشاريع، تكلفة الساعة، ومراكز التكلفة.</li>
                        <li>تقارير موحدة تجمع بيانات الموارد البشرية والمالية ضمن لوحة واحدة.</li>
                    </ul>
                </div>
            </section>

            <!-- RBAC -->
            <section id="rbac" class="bg-surface border border-border rounded-2xl shadow-card p-8 space-y-6">
                <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3">
                    <h2 class="text-2xl font-bold text-text-primary">٢) نموذج الصلاحيات (RBAC)</h2>
                    <span class="text-sm text-text-secondary">ثمانية أدوار افتراضية قابلة للتخصيص</span>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div class="border border-border rounded-xl p-4 bg-secondary-50">
                        <h3 class="font-bold text-text-primary">مدير النظام</h3>
                        <p class="text-sm text-text-secondary mt-2">صلاحيات كاملة على جميع الوحدات.</p>
                    </div>
                    <div class="border border-border rounded-xl p-4 bg-secondary-50">
                        <h3 class="font-bold text-text-primary">المدير التنفيذي</h3>
                        <p class="text-sm text-text-secondary mt-2">رؤية شاملة للرواتب والتكاليف والعقود.</p>
                    </div>
                    <div class="border border-border rounded-xl p-4 bg-secondary-50">
                        <h3 class="font-bold text-text-primary">المدير المالي</h3>
                        <p class="text-sm text-text-secondary mt-2">الوصول للرواتب، السلف، قيود الترحيل، تقارير التكلفة.</p>
                    </div>
                    <div class="border border-border rounded-xl p-4 bg-secondary-50">
                        <h3 class="font-bold text-text-primary">المحاسب</h3>
                        <p class="text-sm text-text-secondary mt-2">إدخال ومراجعة قيود الرواتب والسلف والتقارير المرتبطة.</p>
                    </div>
                    <div class="border border-border rounded-xl p-4 bg-secondary-50">
                        <h3 class="font-bold text-text-primary">مدير الموارد البشرية</h3>
                        <p class="text-sm text-text-secondary mt-2">إدارة ملفات الموظفين، العقود، الحضور، الإجازات، والتقييمات.</p>
                    </div>
                    <div class="border border-border rounded-xl p-4 bg-secondary-50">
                        <h3 class="font-bold text-text-primary">مشرف الموقع</h3>
                        <p class="text-sm text-text-secondary mt-2">مشاهدة الفريق المعين، الحضور اليومي، وطلبات الإذن.</p>
                    </div>
                    <div class="border border-border rounded-xl p-4 bg-secondary-50">
                        <h3 class="font-bold text-text-primary">المهندس</h3>
                        <p class="text-sm text-text-secondary mt-2">الاطلاع على سجلاته الذاتية للحضور والإجازة والراتب دون قيمة العقد.</p>
                    </div>
                    <div class="border border-border rounded-xl p-4 bg-secondary-50">
                        <h3 class="font-bold text-text-primary">الموظف</h3>
                        <p class="text-sm text-text-secondary mt-2">بوابة ذاتية للخدمات الشخصية (Self-Service).</p>
                    </div>
                </div>

                <div class="overflow-x-auto border border-border rounded-xl">
                    <table class="min-w-full divide-y divide-border text-sm">
                        <thead class="bg-secondary-50 text-text-secondary uppercase text-xs">
                            <tr>
                                <th class="px-4 py-3 text-right">الكيان/العملية</th>
                                <th class="px-4 py-3 text-center">Admin</th>
                                <th class="px-4 py-3 text-center">CEO</th>
                                <th class="px-4 py-3 text-center">CFO</th>
                                <th class="px-4 py-3 text-center">Accountant</th>
                                <th class="px-4 py-3 text-center">HR Mgr</th>
                                <th class="px-4 py-3 text-center">Supervisor</th>
                                <th class="px-4 py-3 text-center">Engineer</th>
                                <th class="px-4 py-3 text-center">Employee</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-border text-text-secondary">
                            <tr>
                                <td class="px-4 py-3 font-medium text-text-primary">الموظفون (قراءة)</td>
                                <td class="text-center">✓</td>
                                <td class="text-center">✓</td>
                                <td class="text-center">محدود</td>
                                <td class="text-center">محدود</td>
                                <td class="text-center">✓</td>
                                <td class="text-center">محدود</td>
                                <td class="text-center">ذاتي</td>
                                <td class="text-center">ذاتي</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-3 font-medium text-text-primary">الموظفون (إضافة/تعديل)</td>
                                <td class="text-center">✓</td>
                                <td class="text-center">—</td>
                                <td class="text-center">—</td>
                                <td class="text-center">—</td>
                                <td class="text-center">✓</td>
                                <td class="text-center">—</td>
                                <td class="text-center">—</td>
                                <td class="text-center">—</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-3 font-medium text-text-primary">العقود (عرض القيمة)</td>
                                <td class="text-center">✓</td>
                                <td class="text-center">✓</td>
                                <td class="text-center">✓</td>
                                <td class="text-center">محدود</td>
                                <td class="text-center">✓ (بدون التكلفة الإجمالية)</td>
                                <td class="text-center">—</td>
                                <td class="text-center">إخفاء القيمة</td>
                                <td class="text-center">—</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-3 font-medium text-text-primary">الرواتب (الحساب/الترحيل)</td>
                                <td class="text-center">✓</td>
                                <td class="text-center">✓</td>
                                <td class="text-center">✓</td>
                                <td class="text-center">✓</td>
                                <td class="text-center">اقتراح فقط</td>
                                <td class="text-center">—</td>
                                <td class="text-center">ذاتي (قسط/سلف)</td>
                                <td class="text-center">ذاتي</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-3 font-medium text-text-primary">السلف (إنشاء/اعتماد)</td>
                                <td class="text-center">✓</td>
                                <td class="text-center">✓</td>
                                <td class="text-center">✓</td>
                                <td class="text-center">✓</td>
                                <td class="text-center">طلب فقط</td>
                                <td class="text-center">طلب فقط</td>
                                <td class="text-center">طلب ذاتي</td>
                                <td class="text-center">طلب ذاتي</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-3 font-medium text-text-primary">الحضور (قراءة/اعتماد)</td>
                                <td class="text-center">✓</td>
                                <td class="text-center">✓</td>
                                <td class="text-center">—</td>
                                <td class="text-center">—</td>
                                <td class="text-center">✓</td>
                                <td class="text-center">✓ (فرقته فقط)</td>
                                <td class="text-center">ذاتي</td>
                                <td class="text-center">ذاتي</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-3 font-medium text-text-primary">الأذونات والإجازات</td>
                                <td class="text-center">✓</td>
                                <td class="text-center">✓</td>
                                <td class="text-center">—</td>
                                <td class="text-center">—</td>
                                <td class="text-center">✓</td>
                                <td class="text-center">توصية</td>
                                <td class="text-center">ذاتي</td>
                                <td class="text-center">ذاتي</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-3 font-medium text-text-primary">التقارير الحساسة (تكلفة إجمالية)</td>
                                <td class="text-center">✓</td>
                                <td class="text-center">✓</td>
                                <td class="text-center">✓</td>
                                <td class="text-center">محدود</td>
                                <td class="text-center">—</td>
                                <td class="text-center">—</td>
                                <td class="text-center">—</td>
                                <td class="text-center">—</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <p class="text-sm text-text-secondary">"محدود" تعني تقارير مجمعة بدون تفاصيل العقد أو الراتب الفردية، مع قابلية التوسع بسياسات ABAC حسب مركز التكلفة أو المشروع.</p>
            </section>

            <!-- Database Schema -->
            <section id="database" class="bg-surface border border-border rounded-2xl shadow-card p-8 space-y-6">
                <h2 class="text-2xl font-bold text-text-primary">٣) مخطط قاعدة البيانات (ERD) – نصي</h2>
                <pre class="bg-gray-900 text-gray-100 text-xs rounded-lg p-4 overflow-auto"><code>User(id, email, phone, password_hash, status, last_login_at)
Role(id, key, name_ar, description)
UserRole(user_id, role_id)
Permission(id, key, name_ar)
RolePermission(role_id, permission_id)

Employee(id, user_id, code, full_name, national_id, hire_date,
         job_title, department_id, project_id, manager_id, status, grade,
         hourly_rate, monthly_basic, allowances_json, bank_iban,
         created_at, updated_at)
Department(id, name_ar, cost_center_code)
Project(id, code, name_ar, cost_center_code)

Contract(id, employee_id, type, start_date, end_date, probation_end,
         basic_salary, allowances_json, currency, visibility_scope,
         signed_file_url, created_at)

Attendance(id, employee_id, day, check_in, check_out,
          shift_code, overtime_minutes, status)
Leave(id, employee_id, type, start_date, end_date, status, approved_by, notes)

PayrollBatch(id, month, year, status, posted_journal_id, created_by)
PayrollItem(id, batch_id, employee_id, earnings_json, deductions_json,
            gross, net, loan_deduction, advance_deduction, cost_center)

Advance(id, employee_id, request_date, amount, currency, status,
        approved_by, repayment_months, reason)
Loan(id, employee_id, principal, remaining, installment, start_month, status)

Expense(id, project_id, employee_id, category, amount, currency, date,
        cost_center, reference, approved_by)

Journal(id, date, description, status)
JournalEntry(id, journal_id, account_code, debit, credit, cost_center, ref)

AuditLog(id, actor_user_id, action, entity, entity_id, before_json, after_json, at)</code></pre>
                <div class="bg-secondary-50 border border-border rounded-xl p-5">
                    <h3 class="font-bold text-text-primary mb-3">فهارس أساسية</h3>
                    <ul class="list-disc pr-5 space-y-2 text-text-secondary">
                        <li>فهرسة <code class="bg-secondary-100 px-1 rounded">employee_id</code>، <code class="bg-secondary-100 px-1 rounded">project_id</code>، <code class="bg-secondary-100 px-1 rounded">cost_center_code</code> لربط سريع بالمالية.</li>
                        <li>فهارس مركبة على <code class="bg-secondary-100 px-1 rounded">PayrollBatch(month, year)</code> و<code class="bg-secondary-100 px-1 rounded">Attendance.day</code>.</li>
                        <li>اعتماد Partitioning اختياري لجداول الحضور والرواتب الثقيلة.</li>
                    </ul>
                </div>
            </section>

            <!-- Sensitive data policies -->
            <section id="data-governance" class="bg-surface border border-border rounded-2xl shadow-card p-8 space-y-6">
                <h2 class="text-2xl font-bold text-text-primary">٤) سياسات إخفاء الحقول الحساسة</h2>
                <p class="text-text-secondary leading-relaxed">في طبقة الخدمات يتم تطبيق مرشح عرض بناءً على الدور لضمان حماية البيانات المالية الحساسة:</p>
                <ul class="list-disc pr-5 space-y-2 text-text-secondary">
                    <li>المهندسون، المشرفون، والموظفون لا يرون <code class="bg-secondary-100 px-1 rounded">basic_salary</code> و<code class="bg-secondary-100 px-1 rounded">allowances_json</code> داخل العقود.</li>
                    <li>المحاسب يرى القيم الإجمالية دون تفاصيل العقد الفردية.</li>
                    <li>توفير Views مختلفة على مستوى SQL لكل فئة دور عند الحاجة.</li>
                </ul>
                <div class="bg-secondary-50 border border-border rounded-xl p-5">
                    <h3 class="font-bold text-text-primary mb-3">مثال View مختصر (PostgreSQL)</h3>
                    <pre class="bg-gray-900 text-gray-100 text-xs rounded-lg p-4 overflow-auto"><code>CREATE VIEW v_employee_public AS
SELECT e.id, e.full_name, e.job_title, d.name_ar AS department, p.name_ar AS project
FROM Employee e
LEFT JOIN Department d ON d.id = e.department_id
LEFT JOIN Project p ON p.id = e.project_id;</code></pre>
                </div>
            </section>

            <!-- Workflows -->
            <section id="workflows" class="bg-surface border border-border rounded-2xl shadow-card p-8 space-y-6">
                <h2 class="text-2xl font-bold text-text-primary">٥) التدفقات الرئيسية (Workflows)</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="border border-border rounded-xl p-6">
                        <h3 class="text-lg font-bold text-text-primary mb-3">أ) دورة العقد</h3>
                        <ol class="list-decimal pr-5 space-y-2 text-text-secondary text-sm">
                            <li>ينشئ HR عقدًا جديدًا ويُرفق ملف PDF مع تحديد تفاصيل الموظف.</li>
                            <li>يعتمد مدير النظام نطاق الظهور <code class="bg-secondary-100 px-1 rounded">visibility_scope</code>.</li>
                            <li>عند الاعتماد يتم تسجيل حدث في <code class="bg-secondary-100 px-1 rounded">AuditLog</code> مع قبل/بعد.</li>
                        </ol>
                    </div>
                    <div class="border border-border rounded-xl p-6">
                        <h3 class="text-lg font-bold text-text-primary mb-3">ب) دورة السلف/القروض</h3>
                        <ol class="list-decimal pr-5 space-y-2 text-text-secondary text-sm">
                            <li>يقدم الموظف طلب سلفة عبر البوابة الذاتية.</li>
                            <li>يستقبل HR/CFO إشعارًا للمراجعة والاعتماد.</li>
                            <li>بعد الموافقة يُنشأ <code class="bg-secondary-100 px-1 rounded">Advance</code> أو <code class="bg-secondary-100 px-1 rounded">Loan</code> وتحدد خطة السداد.</li>
                            <li>يتم خصم الأقساط تلقائيًا عند ترحيل الرواتب مع إنشاء قيود يومية مرتبطة بمراكز التكلفة.</li>
                        </ol>
                    </div>
                    <div class="border border-border rounded-xl p-6">
                        <h3 class="text-lg font-bold text-text-primary mb-3">ج) الحضور والإجازات</h3>
                        <ol class="list-decimal pr-5 space-y-2 text-text-secondary text-sm">
                            <li>المشرف يعتمد حضور فريقه فقط.</li>
                            <li>HR يدير الاستثناءات والتعديلات.</li>
                            <li>وحدة الرواتب تقرأ الحضور لحساب البدلات والخصومات.</li>
                        </ol>
                    </div>
                    <div class="border border-border rounded-xl p-6">
                        <h3 class="text-lg font-bold text-text-primary mb-3">د) الرواتب (Payroll)</h3>
                        <ol class="list-decimal pr-5 space-y-2 text-text-secondary text-sm">
                            <li>إنشاء <code class="bg-secondary-100 px-1 rounded">PayrollBatch(month, year)</code>.</li>
                            <li>حساب المستحقات: الأساسي + البدلات − الخصومات − الأقساط + الساعات الإضافية.</li>
                            <li>ترحيل محاسبي تلقائي عبر <code class="bg-secondary-100 px-1 rounded">Journal</code> و<code class="bg-secondary-100 px-1 rounded">JournalEntry</code>.</li>
                        </ol>
                    </div>
                </div>
            </section>

            <!-- APIs -->
            <section id="apis" class="bg-surface border border-border rounded-2xl shadow-card p-8 space-y-6">
                <h2 class="text-2xl font-bold text-text-primary">٦) واجهات برمجة التطبيقات (REST)</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="border border-border rounded-xl p-6">
                        <h3 class="font-bold text-text-primary mb-3">الهوية والصلاحيات</h3>
                        <pre class="bg-gray-900 text-gray-100 text-xs rounded-lg p-4 overflow-auto"><code>POST /api/auth/login
GET  /api/iam/users
POST /api/iam/roles
POST /api/iam/roles/{id}/permissions</code></pre>
                    </div>
                    <div class="border border-border rounded-xl p-6">
                        <h3 class="font-bold text-text-primary mb-3">الموظفون والعقود</h3>
                        <pre class="bg-gray-900 text-gray-100 text-xs rounded-lg p-4 overflow-auto"><code>GET  /api/employees?projectId=&amp;departmentId=&amp;q=
POST /api/employees
GET  /api/employees/{id}
PATCH /api/employees/{id}

POST /api/employees/{id}/contracts
GET  /api/employees/{id}/contracts</code></pre>
                    </div>
                    <div class="border border-border rounded-xl p-6">
                        <h3 class="font-bold text-text-primary mb-3">الحضور والإجازات</h3>
                        <pre class="bg-gray-900 text-gray-100 text-xs rounded-lg p-4 overflow-auto"><code>POST /api/attendance/bulk
GET  /api/attendance?employeeId=&amp;from=&amp;to=
POST /api/leaves
PATCH /api/leaves/{id}/approve</code></pre>
                    </div>
                    <div class="border border-border rounded-xl p-6">
                        <h3 class="font-bold text-text-primary mb-3">السلف والقروض</h3>
                        <pre class="bg-gray-900 text-gray-100 text-xs rounded-lg p-4 overflow-auto"><code>POST /api/advances
PATCH /api/advances/{id}/approve
POST /api/loans
PATCH /api/loans/{id}/settle</code></pre>
                    </div>
                    <div class="border border-border rounded-xl p-6 lg:col-span-2">
                        <h3 class="font-bold text-text-primary mb-3">الرواتب</h3>
                        <pre class="bg-gray-900 text-gray-100 text-xs rounded-lg p-4 overflow-auto"><code>POST /api/payroll/batches
POST /api/payroll/batches/{id}/calculate
POST /api/payroll/batches/{id}/post
GET  /api/payroll/batches/{id}/journal</code></pre>
                    </div>
                </div>
            </section>

            <!-- Sample Code -->
            <section id="code" class="bg-surface border border-border rounded-2xl shadow-card p-8 space-y-6">
                <h2 class="text-2xl font-bold text-text-primary">٧) نماذج أكواد مهمة</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="border border-border rounded-xl p-6 bg-secondary-50">
                        <h3 class="font-bold text-text-primary mb-3">حماية نقطة نهاية حسب الدور</h3>
                        <pre class="bg-gray-900 text-gray-100 text-xs rounded-lg p-4 overflow-auto"><code>// middleware/requireRole.ts
export function requireRole(roles: string[]) {
  return (req, res, next) => {
    const user = req.user;
    if (!user || !roles.some(r => user.roles.includes(r))) {
      return res.status(403).json({ message: 'ليس لديك صلاحية' });
    }
    next();
  };
}</code></pre>
                    </div>
                    <div class="border border-border rounded-xl p-6 bg-secondary-50">
                        <h3 class="font-bold text-text-primary mb-3">فلترة الحقول الحساسة</h3>
                        <pre class="bg-gray-900 text-gray-100 text-xs rounded-lg p-4 overflow-auto"><code>function sanitizeContractForRole(contract: any, roleKeys: string[]): any {
  const canSeeMoney = roleKeys.some(r => ['admin','ceo','cfo'].includes(r));
  if (!canSeeMoney) {
    const { basic_salary, allowances_json, ...rest } = contract;
    return rest;
  }
  return contract;
}</code></pre>
                    </div>
                    <div class="border border-border rounded-xl p-6 bg-secondary-50">
                        <h3 class="font-bold text-text-primary mb-3">حساب قسط السلفة داخل الرواتب</h3>
                        <pre class="bg-gray-900 text-gray-100 text-xs rounded-lg p-4 overflow-auto"><code>function computeNet(pay: PayrollItem, loan?: Loan) {
  const loanDeduction = loan ? Math.min(loan.installment, loan.remaining) : 0;
  const gross = pay.gross;
  const net = gross - loanDeduction;
  return { ...pay, loan_deduction: loanDeduction, net };
}</code></pre>
                    </div>
                    <div class="border border-border rounded-xl p-6 bg-secondary-50">
                        <h3 class="font-bold text-text-primary mb-3">قيد يومية بسيط للرواتب</h3>
                        <pre class="bg-gray-900 text-gray-100 text-xs rounded-lg p-4 overflow-auto"><code>insertJournal(date, 'ترحيل رواتب شهرية', [
  { account: '5001', debit: totalSalaries, credit: 0, cost_center: 'HR' },
  { account: '2103', debit: 0, credit: totalSalaries, cost_center: 'HR' },
]);</code></pre>
                    </div>
                </div>
            </section>

            <!-- UI Overview -->
            <section id="ui" class="bg-surface border border-border rounded-2xl shadow-card p-8 space-y-6">
                <h2 class="text-2xl font-bold text-text-primary">٨) الواجهة – الصفحات والمكونات</h2>
                <p class="text-text-secondary leading-relaxed">تصميم واجهة المستخدم يحاكي أنظمة إدارة المشاريع والمحاسبة العالمية مع الالتزام بهوية ContractorPro:</p>
                <ul class="list-disc pr-5 space-y-2 text-text-secondary">
                    <li>قائمة الموظفين ببحث وفلاتر (قسم، مشروع، حالة) وأعمدة قابلة للتخصيص.</li>
                    <li>ملف موظف شامل: بيانات أساسية، عقود، مرفقات، تاريخ وظيفي، أداء، وسجل رواتب.</li>
                    <li>وحدة العقود مع تحميل الملفات، تحديد نطاق الظهور، وسجل الموافقات.</li>
                    <li>إدارة الحضور عبر تقويم، إدخال جماعي، واعتمادات المشرفين.</li>
                    <li>بوابة الإجازات والسلف والقروض بطلبات واعتمادات متعددة المستويات.</li>
                    <li>دفعات الرواتب الشهرية مع حساب، مراجعة، وترحيل محاسبي متكامل.</li>
                    <li>التقارير الحساسة لتكلفة الموظف، المركز، والمشروع مع سياسات ظهور محددة.</li>
                    <li>لوحة إدارة الأدوار والصلاحيات لإنشاء وربط الصلاحيات بالمستخدمين.</li>
                </ul>
            </section>

            <!-- Security & Performance -->
            <section id="security" class="bg-surface border border-border rounded-2xl shadow-card p-8 space-y-6">
                <h2 class="text-2xl font-bold text-text-primary">٩) سياسات الأمن والامتثال &amp; ١٠) الأداء وقابلية التوسع</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="border border-border rounded-xl p-6 bg-secondary-50">
                        <h3 class="font-bold text-text-primary mb-3">الأمن والامتثال</h3>
                        <ul class="list-disc pr-5 space-y-2 text-text-secondary text-sm">
                            <li>تشفير كلمات المرور باستخدام Argon2 أو BCrypt.</li>
                            <li>تدوير مفاتيح JWT وإضافة Refresh Tokens.</li>
                            <li>سجل تدقيق لكل عملية حساسة مع Masking للحقول الحساسة في السجلات.</li>
                            <li>صلاحيات دقيقة للمرفقات وعمليات التنزيل.</li>
                        </ul>
                    </div>
                    <div class="border border-border rounded-xl p-6 bg-secondary-50">
                        <h3 class="font-bold text-text-primary mb-3">الأداء وقابلية التوسع</h3>
                        <ul class="list-disc pr-5 space-y-2 text-text-secondary text-sm">
                            <li>فهارس مدروسة واستعلامات مجمعة للتقارير.</li>
                            <li>Job Queue لحساب الرواتب وترحيل القيود.</li>
                            <li>Cache لتقارير القراءة الثقيلة وتجزئة للخدمات.</li>
                            <li>مراقبة وتحذيرات زمنية لضمان الاستجابة.</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Roadmap -->
            <section id="roadmap" class="bg-surface border border-border rounded-2xl shadow-card p-8 space-y-6">
                <h2 class="text-2xl font-bold text-text-primary">١١) خارطة الطريق (Roadmap)</h2>
                <div class="space-y-4">
                    <div class="border border-border rounded-xl p-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
                        <div class="flex items-center gap-3">
                            <span class="w-10 h-10 rounded-full bg-primary text-white flex items-center justify-center font-bold">1</span>
                            <h3 class="font-bold text-text-primary">المرحلة 1</h3>
                        </div>
                        <p class="text-text-secondary text-sm">الموظفون + العقود + الحضور/الإجازات + RBAC أساسي.</p>
                    </div>
                    <div class="border border-border rounded-xl p-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
                        <div class="flex items-center gap-3">
                            <span class="w-10 h-10 rounded-full bg-success text-white flex items-center justify-center font-bold">2</span>
                            <h3 class="font-bold text-text-primary">المرحلة 2</h3>
                        </div>
                        <p class="text-text-secondary text-sm">الرواتب والسلف + تكامل القيود المحاسبية.</p>
                    </div>
                    <div class="border border-border rounded-xl p-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
                        <div class="flex items-center gap-3">
                            <span class="w-10 h-10 rounded-full bg-warning text-white flex items-center justify-center font-bold">3</span>
                            <h3 class="font-bold text-text-primary">المرحلة 3</h3>
                        </div>
                        <p class="text-text-secondary text-sm">الأداء والتقييمات + مسارات موافقات متعددة (Workflow Engine).</p>
                    </div>
                    <div class="border border-border rounded-xl p-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
                        <div class="flex items-center gap-3">
                            <span class="w-10 h-10 rounded-full bg-accent text-white flex items-center justify-center font-bold">4</span>
                            <h3 class="font-bold text-text-primary">المرحلة 4</h3>
                        </div>
                        <p class="text-text-secondary text-sm">تطبيق جوال للموظف (Self-Service) مع إشعارات فورية.</p>
                    </div>
                </div>
            </section>

            <!-- Finance Integration -->
            <section id="integration" class="bg-surface border border-border rounded-2xl shadow-card p-8 space-y-6">
                <h2 class="text-2xl font-bold text-text-primary">١٢) نقاط تكامل مع قسم المالية</h2>
                <ul class="list-disc pr-5 space-y-2 text-text-secondary">
                    <li>عند اعتماد <code class="bg-secondary-100 px-1 rounded">PayrollBatch</code>: إنشاء قيود يومية وربطها بمركز التكلفة لكل موظف/مشروع.</li>
                    <li>عند إنشاء سلفة أو قرض: قيود تلقائية (سلفة مدينة/رواتب مستحقة) وتحديث الرصيد المتبقي.</li>
                    <li>تقارير موحدة لتكلفة المشروع = مصروفات مباشرة + رواتب محمّلة على المشروع حسب ساعات العمل.</li>
                </ul>
            </section>

            <!-- Prisma sample -->
            <section id="prisma" class="bg-surface border border-border rounded-2xl shadow-card p-8 space-y-6">
                <h2 class="text-2xl font-bold text-text-primary">١٣) عيّنة مخطط Prisma</h2>
                <pre class="bg-gray-900 text-gray-100 text-xs rounded-lg p-4 overflow-auto"><code>model Employee {
  id           String   @id @default(cuid())
  userId       String?  @unique
  code         String   @unique
  fullName     String
  jobTitle     String?
  departmentId String?
  projectId    String?
  hireDate     DateTime?
  monthlyBasic Decimal? @db.Decimal(12,2)
  hourlyRate   Decimal? @db.Decimal(12,2)
  bankIban     String?
  status       String   @default("active")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}</code></pre>
            </section>

            <!-- Additional Notes -->
            <section id="notes" class="bg-surface border border-border rounded-2xl shadow-card p-8 space-y-6">
                <h2 class="text-2xl font-bold text-text-primary">١٤) ملاحظات تطبيقية سريعة</h2>
                <ul class="list-disc pr-5 space-y-2 text-text-secondary">
                    <li>إخفاء قيمة العقد للمهندس/المراقب عبر DTO مخصص أو صلاحيات على مستوى الحقول.</li>
                    <li>استخدام Feature Flags لتفعيل وحدات النظام تدريجيًا.</li>
                    <li>بناء Seeder لإنشاء الأدوار والصلاحيات الأولية وتسهيل الانطلاق.</li>
                </ul>
            </section>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const buttons = document.querySelectorAll('[data-scroll-to]');
            buttons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetId = button.getAttribute('data-scroll-to');
                    const targetSection = document.getElementById(targetId);
                    if (targetSection) {
                        targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                });
            });
        });
    </script>
    <script id="dhws-dataInjector" src="../public/dhws-data-injector.js"></script>
    <script src="../js/session.js" data-login-path="../login.html"></script>
</body>
</html>
