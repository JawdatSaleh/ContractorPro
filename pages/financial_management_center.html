<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>مركز إدارة المالية - ContractorPro</title>
    <link rel="stylesheet" href="../css/main.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script type="module" src="https://static.rocket.new/rocket-web.js?_cfg=https%3A%2F%2Fcontractor7112back.builtwithrocket.new&_be=https%3A%2F%2Fapplication.rocket.new&_v=0.1.8"></script>
<script type="module" src="https://static.rocket.new/rocket-shot.js?v=0.0.1"></script>
</head>
<body class="bg-background font-arabic">
    <!-- Navigation Sidebar -->
    <div class="fixed right-0 top-0 h-full w-64 bg-surface shadow-modal z-50 transform transition-transform duration-300" id="sidebar">
        <div class="p-6 border-b border-border">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-primary rounded-lg flex items-center justify-center">
                    <i class="fas fa-hard-hat text-white text-lg"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold text-text-primary">ContractorPro</h1>
                    <p class="text-sm text-text-secondary">نظام إدارة المقاولات</p>
                </div>
            </div>
        </div>
        
        <nav class="p-4 space-y-2">
            <!-- Dashboard -->
            <a href="main_dashboard.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-text-secondary hover:bg-secondary-100 transition-fast">
                <i class="fas fa-tachometer-alt w-5"></i>
                <span class="font-medium">لوحة التحكم</span>
            </a>

            <!-- Projects Section -->
            <a href="projects_management_center.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-text-secondary hover:bg-secondary-100 transition-fast">
                <i class="fas fa-building w-5"></i>
                <span>المشاريع</span>
                <i class="fas fa-chevron-left mr-auto text-xs"></i>
            </a>

            <!-- Finance Section -->
            <a href="financial_management_center.html" class="flex items-center gap-3 px-4 py-3 rounded-lg bg-primary-50 text-primary border-r-4 border-primary">
                <i class="fas fa-chart-line w-5"></i>
                <span>المالية</span>
                <i class="fas fa-chevron-left mr-auto text-xs"></i>
            </a>

            <!-- Employees Section -->
            <a href="employees_management_center.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-text-secondary hover:bg-secondary-100 transition-fast">
                <i class="fas fa-users w-5"></i>
                <span>الموظفين</span>
                <i class="fas fa-chevron-left mr-auto text-xs"></i>
            </a>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="mr-64 min-h-screen">
        <!-- Top Header -->
        <header class="bg-surface shadow-card px-6 py-4 border-b border-border">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-2xl font-bold text-text-primary">مركز إدارة المالية المتقدم</h1>
                    <p class="text-text-secondary">نظام مالي شامل مع التقارير والتحليلات المتقدمة والفواتير الضريبية</p>
                </div>
                
                <div class="flex items-center gap-3">
                    <button class="bg-success text-white px-4 py-2 rounded-lg hover:bg-success-600 transition-fast flex items-center gap-2 shadow-md" onclick="generateTaxInvoice()">
                        <i class="fas fa-file-invoice-dollar"></i>
                        <span>إنشاء فاتورة</span>
                    </button>
                    <button class="bg-gradient-to-r from-orange-500 to-orange-600 text-white px-4 py-2 rounded-lg hover:from-orange-600 hover:to-orange-700 transition-all flex items-center gap-2 shadow-lg transform hover:scale-105" onclick="openAdvancedQuotationDesigner()">
                        <i class="fas fa-magic"></i>
                        <span>العروض الذكية</span>
                    </button>
                    <button class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-600 transition-fast flex items-center gap-2 shadow-md" onclick="openComprehensiveInvoices()">
                        <i class="fas fa-receipt"></i>
                        <span>مركز الفواتير</span>
                    </button>
                    <button class="bg-warning text-white px-4 py-2 rounded-lg hover:bg-warning-600 transition-fast flex items-center gap-2 shadow-md" onclick="generateFinancialReport()">
                        <i class="fas fa-chart-bar"></i>
                        <span>التقارير</span>
                    </button>
                    <div class="relative">
                        <button class="bg-secondary-200 text-text-primary px-4 py-2 rounded-lg hover:bg-secondary-300 transition-fast flex items-center gap-2" onclick="toggleNotifications()">
                            <i class="fas fa-bell"></i>
                            <span class="bg-error text-white rounded-full px-2 py-0.5 text-xs absolute -top-2 -right-1">3</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Financial KPIs Dashboard -->
        <section class="p-6 bg-gradient-to-br from-primary-50 to-secondary-50 border-b border-border">
            <div class="grid grid-cols-1 md:grid-cols-5 gap-6">
                <!-- Total Revenue -->
                <div class="bg-gradient-to-br from-success-500 to-success-600 rounded-xl p-6 text-white shadow-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-success-100 text-sm font-medium mb-1">إجمالي الإيرادات</p>
                            <p class="text-3xl font-bold">2.4M ريال</p>
                            <div class="flex items-center gap-2 mt-3">
                                <i class="fas fa-arrow-up text-sm"></i>
                                <span class="text-sm font-medium">+15.3% عن الشهر السابق</span>
                            </div>
                        </div>
                        <div class="w-14 h-14 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
                            <i class="fas fa-chart-line text-2xl"></i>
                        </div>
                    </div>
                </div>

                <!-- Total Expenses -->
                <div class="bg-gradient-to-br from-error-500 to-error-600 rounded-xl p-6 text-white shadow-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-error-100 text-sm font-medium mb-1">إجمالي المصروفات</p>
                            <p class="text-3xl font-bold">1.8M ريال</p>
                            <div class="flex items-center gap-2 mt-3">
                                <i class="fas fa-arrow-up text-sm"></i>
                                <span class="text-sm font-medium">+8.7% عن الشهر السابق</span>
                            </div>
                        </div>
                        <div class="w-14 h-14 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
                            <i class="fas fa-receipt text-2xl"></i>
                        </div>
                    </div>
                </div>

                <!-- Net Profit -->
                <div class="bg-gradient-to-br from-primary-500 to-primary-600 rounded-xl p-6 text-white shadow-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-primary-100 text-sm font-medium mb-1">صافي الربح</p>
                            <p class="text-3xl font-bold">600K ريال</p>
                            <div class="flex items-center gap-2 mt-3">
                                <i class="fas fa-arrow-up text-sm"></i>
                                <span class="text-sm font-medium">+25% هامش ربح</span>
                            </div>
                        </div>
                        <div class="w-14 h-14 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
                            <i class="fas fa-coins text-2xl"></i>
                        </div>
                    </div>
                </div>

                <!-- Pending Receivables -->
                <div class="bg-gradient-to-br from-warning-500 to-warning-600 rounded-xl p-6 text-white shadow-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-warning-100 text-sm font-medium mb-1">مستحقات معلقة</p>
                            <p class="text-3xl font-bold">320K ريال</p>
                            <div class="flex items-center gap-2 mt-3">
                                <i class="fas fa-exclamation-triangle text-sm"></i>
                                <span class="text-sm font-medium">تحتاج متابعة عاجلة</span>
                            </div>
                        </div>
                        <div class="w-14 h-14 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
                            <i class="fas fa-hourglass-half text-2xl"></i>
                        </div>
                    </div>
                </div>

                <!-- Cash Flow -->
                <div class="bg-gradient-to-br from-secondary-500 to-secondary-600 rounded-xl p-6 text-white shadow-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-secondary-100 text-sm font-medium mb-1">التدفق النقدي</p>
                            <p class="text-3xl font-bold">+180K ريال</p>
                            <div class="flex items-center gap-2 mt-3">
                                <i class="fas fa-water text-sm"></i>
                                <span class="text-sm font-medium">هذا الشهر</span>
                            </div>
                        </div>
                        <div class="w-14 h-14 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
                            <i class="fas fa-exchange-alt text-2xl"></i>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Quick Actions -->
        <section class="p-6 bg-surface border-b border-border">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-bold text-text-primary">الإجراءات السريعة</h2>
                <div class="flex gap-2">
                    <button class="text-xs bg-primary text-white px-3 py-1 rounded-md hover:bg-primary-600 transition-fast" onclick="refreshData()">
                        <i class="fas fa-sync-alt ml-1"></i>تحديث البيانات
                    </button>
                    <button class="text-xs bg-secondary-200 text-text-primary px-3 py-1 rounded-md hover:bg-secondary-300 transition-fast" onclick="exportData()">
                        <i class="fas fa-download ml-1"></i>تصدير
                    </button>
                </div>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-6 gap-4">
                <button class="bg-white border border-border rounded-lg p-4 hover:shadow-lg transition-all text-center group" onclick="openComprehensiveInvoices()">
                    <div class="w-12 h-12 bg-primary-100 rounded-lg mx-auto mb-3 flex items-center justify-center group-hover:bg-primary-200">
                        <i class="fas fa-file-invoice text-primary text-xl"></i>
                    </div>
                    <h3 class="font-medium text-text-primary text-sm">مركز الفواتير</h3>
                    <p class="text-xs text-text-secondary mt-1">إدارة شاملة</p>
                </button>

                <button class="bg-white border border-border rounded-lg p-4 hover:shadow-lg transition-all text-center group" onclick="openExpensesCenter()">
                    <div class="w-12 h-12 bg-error-100 rounded-lg mx-auto mb-3 flex items-center justify-center group-hover:bg-error-200">
                        <i class="fas fa-receipt text-error text-xl"></i>
                    </div>
                    <h3 class="font-medium text-text-primary text-sm">المصروفات</h3>
                    <p class="text-xs text-text-secondary mt-1">تتبع وتصنيف</p>
                </button>

                <button class="bg-gradient-to-br from-orange-400 to-orange-500 border border-orange-300 rounded-lg p-4 hover:shadow-xl transition-all text-center group transform hover:scale-105" onclick="openAdvancedQuotationDesigner()">
                    <div class="w-12 h-12 bg-white bg-opacity-20 rounded-lg mx-auto mb-3 flex items-center justify-center group-hover:bg-opacity-30">
                        <i class="fas fa-magic text-white text-xl"></i>
                    </div>
                    <h3 class="font-medium text-white text-sm">العروض الذكية</h3>
                    <p class="text-xs text-orange-100 mt-1">عمران الخليج</p>
                </button>

                <button class="bg-white border border-border rounded-lg p-4 hover:shadow-lg transition-all text-center group" onclick="openQuotationsCenter()">
                    <div class="w-12 h-12 bg-warning-100 rounded-lg mx-auto mb-3 flex items-center justify-center group-hover:bg-warning-200">
                        <i class="fas fa-file-contract text-warning text-xl"></i>
                    </div>
                    <h3 class="font-medium text-text-primary text-sm">العروض العادية</h3>
                    <p class="text-xs text-text-secondary mt-1">إدارة تقليدية</p>
                </button>

                <button class="bg-white border border-border rounded-lg p-4 hover:shadow-lg transition-all text-center group" onclick="openAccountsCenter()">
                    <div class="w-12 h-12 bg-success-100 rounded-lg mx-auto mb-3 flex items-center justify-center group-hover:bg-success-200">
                        <i class="fas fa-university text-success text-xl"></i>
                    </div>
                    <h3 class="font-medium text-text-primary text-sm">الحسابات</h3>
                    <p class="text-xs text-text-secondary mt-1">البنوك والصندوق</p>
                </button>

                <button class="bg-white border border-border rounded-lg p-4 hover:shadow-lg transition-all text-center group" onclick="openPaymentTracking()">
                    <div class="w-12 h-12 bg-secondary-100 rounded-lg mx-auto mb-3 flex items-center justify-center group-hover:bg-secondary-200">
                        <i class="fas fa-money-bill-wave text-secondary text-xl"></i>
                    </div>
                    <h3 class="font-medium text-text-primary text-sm">المدفوعات</h3>
                    <p class="text-xs text-text-secondary mt-1">تتبع ومراقبة</p>
                </button>

                <button class="bg-white border border-border rounded-lg p-4 hover:shadow-lg transition-all text-center group" onclick="openFinancialReports()">
                    <div class="w-12 h-12 bg-primary-100 rounded-lg mx-auto mb-3 flex items-center justify-center group-hover:bg-primary-200">
                        <i class="fas fa-chart-bar text-primary text-xl"></i>
                    </div>
                    <h3 class="font-medium text-text-primary text-sm">التقارير</h3>
                    <p class="text-xs text-text-secondary mt-1">تحليلات مالية</p>
                </button>
            </div>
        </section>

        <!-- Charts Section -->
        <section class="p-6">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <!-- Revenue vs Expenses Chart -->
                <div class="bg-surface rounded-xl p-6 shadow-card border border-border">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-bold text-text-primary">الإيرادات مقابل المصروفات</h3>
                        <div class="flex gap-2">
                            <select class="px-3 py-1 border border-border rounded-lg text-sm focus:border-primary focus:outline-none" onchange="updateChartPeriod(this.value)">
                                <option value="6months">آخر 6 أشهر</option>
                                <option value="1year">آخر سنة</option>
                                <option value="2years">آخر سنتين</option>
                            </select>
                            <button class="text-xs bg-secondary-200 text-text-primary px-2 py-1 rounded hover:bg-secondary-300" onclick="exportChart('revenueExpenses')">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="h-64 relative">
                        <canvas id="revenueExpensesChart"></canvas>
                    </div>
                </div>

                <!-- Cash Flow Forecast -->
                <div class="bg-surface rounded-xl p-6 shadow-card border border-border">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-bold text-text-primary">توقعات التدفق النقدي</h3>
                        <div class="flex gap-2">
                            <select class="px-3 py-1 border border-border rounded-lg text-sm focus:border-primary focus:outline-none">
                                <option>الأشهر القادمة</option>
                                <option>الربع القادم</option>
                                <option>السنة القادمة</option>
                            </select>
                            <button class="text-xs bg-secondary-200 text-text-primary px-2 py-1 rounded hover:bg-secondary-300" onclick="exportChart('cashFlow')">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="h-64 relative">
                        <canvas id="cashFlowChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Recent Activity and Project Financial Analysis -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Recent Financial Activity -->
                <div class="lg:col-span-1 bg-surface rounded-xl p-6 shadow-card border border-border">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-bold text-text-primary">النشاط المالي الأخير</h3>
                        <button class="text-xs text-primary hover:text-primary-600" onclick="viewAllActivity()">عرض الكل</button>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="flex items-center gap-3 p-3 bg-success-50 rounded-lg">
                            <div class="w-8 h-8 bg-success-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-arrow-up text-success text-sm"></i>
                            </div>
                            <div class="flex-1">
                                <p class="text-sm font-medium text-text-primary">دفعة مستلمة</p>
                                <p class="text-xs text-text-secondary">425,000 ريال - فيلا الرياض</p>
                            </div>
                            <span class="text-xs text-success font-medium">منذ ساعة</span>
                        </div>

                        <div class="flex items-center gap-3 p-3 bg-error-50 rounded-lg">
                            <div class="w-8 h-8 bg-error-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-arrow-down text-error text-sm"></i>
                            </div>
                            <div class="flex-1">
                                <p class="text-sm font-medium text-text-primary">فاتورة صادرة</p>
                                <p class="text-xs text-text-secondary">INV-2025-004 - 280,000 ريال</p>
                            </div>
                            <span class="text-xs text-error font-medium">منذ 3 ساعات</span>
                        </div>

                        <div class="flex items-center gap-3 p-3 bg-warning-50 rounded-lg">
                            <div class="w-8 h-8 bg-warning-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-exclamation-triangle text-warning text-sm"></i>
                            </div>
                            <div class="flex-1">
                                <p class="text-sm font-medium text-text-primary">فاتورة متأخرة</p>
                                <p class="text-xs text-text-secondary">INV-2025-002 - تأخر 5 أيام</p>
                            </div>
                            <span class="text-xs text-warning font-medium">اليوم</span>
                        </div>

                        <div class="flex items-center gap-3 p-3 bg-primary-50 rounded-lg">
                            <div class="w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-file-contract text-primary text-sm"></i>
                            </div>
                            <div class="flex-1">
                                <p class="text-sm font-medium text-text-primary">عرض سعر جديد</p>
                                <p class="text-xs text-text-secondary">QUO-2025-012 - 890,000 ريال</p>
                            </div>
                            <span class="text-xs text-primary font-medium">أمس</span>
                        </div>
                    </div>
                </div>

                <!-- Project Financial Breakdown -->
                <div class="lg:col-span-2 bg-surface rounded-xl p-6 shadow-card border border-border">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-bold text-text-primary">الأداء المالي للمشاريع</h3>
                        <div class="flex gap-2">
                            <select class="px-3 py-1 border border-border rounded-lg text-sm focus:border-primary focus:outline-none">
                                <option>كافة المشاريع</option>
                                <option>المشاريع النشطة</option>
                                <option>المشاريع المكتملة</option>
                            </select>
                            <button class="text-xs bg-primary text-white px-3 py-1 rounded hover:bg-primary-600" onclick="openProjectsManagement()">
                                إدارة المشاريع
                            </button>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <!-- Project 1 -->
                        <div class="border border-border rounded-lg p-4 hover:shadow-md transition-all">
                            <div class="flex justify-between items-center mb-3">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-success-100 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-building text-success"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-text-primary">فيلا الرياض الحديثة</h4>
                                        <p class="text-xs text-text-secondary">العميل: محمد العبدالله | مكتمل 95%</p>
                                    </div>
                                </div>
                                <div class="text-left">
                                    <span class="text-lg font-bold text-success">+180K ريال</span>
                                    <p class="text-xs text-text-secondary">هامش الربح: 21%</p>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-3 gap-4 mb-3">
                                <div class="text-center">
                                    <p class="text-xs text-text-secondary">إجمالي العقد</p>
                                    <p class="font-bold text-text-primary">850K ريال</p>
                                </div>
                                <div class="text-center">
                                    <p class="text-xs text-text-secondary">المصروفات</p>
                                    <p class="font-bold text-error">670K ريال</p>
                                </div>
                                <div class="text-center">
                                    <p class="text-xs text-text-secondary">المبلغ المستلم</p>
                                    <p class="font-bold text-success">650K ريال</p>
                                </div>
                            </div>
                            
                            <div class="w-full bg-secondary-200 rounded-full h-2 mb-2">
                                <div class="bg-success h-2 rounded-full relative" style="width: 78%">
                                    <div class="absolute right-0 top-0 h-full bg-warning rounded-r-full" style="width: 15%"></div>
                                </div>
                            </div>
                            <div class="flex justify-between text-xs text-text-secondary">
                                <span>مكتمل</span>
                                <span>متبقي: 200K ريال</span>
                            </div>
                        </div>

                        <!-- Project 2 -->
                        <div class="border border-border rounded-lg p-4 hover:shadow-md transition-all">
                            <div class="flex justify-between items-center mb-3">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-primary-100 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-store text-primary"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-text-primary">مجمع تجاري جدة</h4>
                                        <p class="text-xs text-text-secondary">العميل: شركة الأندلس | مكتمل 65%</p>
                                    </div>
                                </div>
                                <div class="text-left">
                                    <span class="text-lg font-bold text-success">+320K ريال</span>
                                    <p class="text-xs text-text-secondary">هامش الربح: 27%</p>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-3 gap-4 mb-3">
                                <div class="text-center">
                                    <p class="text-xs text-text-secondary">إجمالي العقد</p>
                                    <p class="font-bold text-text-primary">1.2M ريال</p>
                                </div>
                                <div class="text-center">
                                    <p class="text-xs text-text-secondary">المصروفات</p>
                                    <p class="font-bold text-error">880K ريال</p>
                                </div>
                                <div class="text-center">
                                    <p class="text-xs text-text-secondary">المبلغ المستلم</p>
                                    <p class="font-bold text-warning">400K ريال</p>
                                </div>
                            </div>
                            
                            <div class="w-full bg-secondary-200 rounded-full h-2 mb-2">
                                <div class="bg-primary h-2 rounded-full" style="width: 45%"></div>
                            </div>
                            <div class="flex justify-between text-xs text-text-secondary">
                                <span>قيد التنفيذ</span>
                                <span>متبقي: 800K ريال</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script>
        // Chart configurations
        let revenueExpensesChart;
        let cashFlowChart;

        // Initialize charts
        function initializeCharts() {
            // Revenue vs Expenses Chart
            const revenueExpensesCtx = document.getElementById('revenueExpensesChart').getContext('2d');
            revenueExpensesChart = new Chart(revenueExpensesCtx, {
                type: 'line',
                data: {
                    labels: ['يناير', 'فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو'],
                    datasets: [{
                        label: 'الإيرادات',
                        data: [400000, 450000, 380000, 520000, 480000, 600000],
                        borderColor: '#10B981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4,
                        fill: true
                    }, {
                        label: 'المصروفات',
                        data: [320000, 380000, 300000, 420000, 380000, 450000],
                        borderColor: '#EF4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            rtl: true
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString('ar-SA') + ' ريال';
                                }
                            }
                        }
                    }
                }
            });

            // Cash Flow Chart
            const cashFlowCtx = document.getElementById('cashFlowChart').getContext('2d');
            cashFlowChart = new Chart(cashFlowCtx, {
                type: 'bar',
                data: {
                    labels: ['يناير', 'فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو'],
                    datasets: [{
                        label: 'التدفق النقدي',
                        data: [80000, 70000, 80000, 100000, 100000, 150000],
                        backgroundColor: [
                            '#3B82F6',
                            '#10B981',
                            '#F59E0B',
                            '#10B981',
                            '#10B981',
                            '#10B981'
                        ],
                        borderRadius: 6,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString('ar-SA') + ' ريال';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Header action functions
        function generateTaxInvoice() {
            window.location.href = 'tax_invoice_generator.html';
        }

        function openComprehensiveInvoices() {
            window.location.href = 'comprehensive_invoice_management_hub.html';
        }

        function openAdvancedQuotationDesigner() {
            window.location.href = 'advanced_quotation_invoice_designer.html';
        }

        function generateFinancialReport() {
            alert('تم إنشاء التقرير المالي الشامل');
        }

        function toggleNotifications() {
            alert('إشعارات: 3 فواتير تحتاج متابعة');
        }

        // Quick action functions
        function openExpensesCenter() {
            alert('فتح مركز إدارة المصروفات');
        }

        function openQuotationsCenter() {
            window.location.href = 'quotation_management_system.html';
        }

        function openAccountsCenter() {
            alert('فتح مركز إدارة الحسابات البنكية');
        }

        function openPaymentTracking() {
            window.location.href = 'payment_tracking.html';
        }

        function openFinancialReports() {
            window.location.href = 'reports.html';
        }

        function refreshData() {
            alert('تم تحديث البيانات المالية');
            // Refresh charts
            initializeCharts();
        }

        function exportData() {
            alert('تصدير البيانات المالية إلى Excel');
        }

        // Chart functions
        function updateChartPeriod(period) {
            // Update chart data based on selected period
            alert(`تحديث الرسم البياني للفترة: ${period}`);
        }

        function exportChart(chartType) {
            alert(`تصدير الرسم البياني: ${chartType}`);
        }

        // Activity functions
        function viewAllActivity() {
            alert('عرض جميع الأنشطة المالية');
        }

        function openProjectsManagement() {
            window.location.href = 'projects_management_center.html';
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
        });
    </script>
<script id="dhws-dataInjector" src="../public/dhws-data-injector.js"></script>
</body>
</html>